<p-table
  [value]="(nameVariants$ | async)!"
  dataKey="_id"
  class="not-prose"
>
  <ng-template #header>
    <tr>
      <th>Sorting</th>
      <th>Display</th>
      <th class="w-40">Type</th>
      <th class="w-40"></th>
    </tr>
  </ng-template>
  <ng-template #body let-nameVariant>
    <tr>
      @let main = (isMainVariant(nameVariant) | async);
      <td>
        {{ nameVariant.sorting }}
      </td>
      <td>
        {{ nameVariant.display }}
      </td>
      <td>
        <p-tag [severity]="main ? 'success' : 'info'" [icon]="main ? 'pi pi-bookmark' : undefined"
               [value]="nameVariant.type" rounded />
      </td>
      <td>
        <p-buttonGroup>
          <p-button icon="pi pi-pencil" size="small" severity="secondary"
                    (click)="openEditDialog(nameVariant)" />
          <p-button icon="pi pi-bookmark" size="small" severity="secondary"
                    [disabled]="main"
                    (click)="onSetMainVariant(nameVariant)" />
          <p-button icon="pi pi-trash" size="small" severity="danger"
                    [pTooltip]="main ? 'The main variant cannot be deleted' : undefined" tooltipPosition="bottom"
                    [disabled]="main"
                    (click)="onDeleteVariant(nameVariant)" />
        </p-buttonGroup>
      </td>
    </tr>
  </ng-template>
  <ng-template #footer>
    <tr>
      <td colspan="4">
        <p-buttonGroup>
          <p-button icon="pi pi-plus" size="small" severity="success" label="Add" (click)="openEditDialog()"></p-button>
          <ng-content select="p-button"/>
        </p-buttonGroup>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog header="Edit Profile" [modal]="true" [(visible)]="showNameVariantDialog" [style]="{ width: '25rem' }">
  <ng-template #header>
    <span class="text-lg font-bold">{{ nameVariant._id ? 'Edit name variant' : 'Add name variant' }}</span>
  </ng-template>

  <form #nameVariantForm="ngForm" id="editForm" class="flex flex-col gap-2">
    <p-iftalabel>
      <input pInputText id="display" [(ngModel)]="nameVariant.display" name="display" required fluid />
      <label for="display">Display</label>
    </p-iftalabel>
    <p-iftalabel>
      <input pInputText id="sorting" [(ngModel)]="nameVariant.sorting" name="sorting" required fluid />
      <label for="sorting">Sorting</label>
    </p-iftalabel>
    <p-iftalabel>
      <p-select id="type" [options]="types" [(ngModel)]="nameVariant.type" [editable]="true" name="type"
                appendTo="body" showClear required fluid />
      <label for="type">Type</label>
    </p-iftalabel>
  </form>

  <ng-template #footer>
    <p-buttonGroup>
      <p-button label="Cancel" icon="pi pi-times" severity="secondary" (click)="closeEditDialog()" />
      <p-button label="Save" [icon]="isSavingNameVariant ? 'pi pi-spin pi-spinner' : 'pi pi-save'" severity="success"
                [disabled]="isSavingNameVariant || nameVariantForm.invalid"
                (click)="nameVariant._id ? onSaveNameVariant() : onAddNameVariant()" />
    </p-buttonGroup>
  </ng-template>
</p-dialog>
